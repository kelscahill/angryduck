import{d as ue,G as me,b as w,c as p,o as s,f as K,u as r,k as n,q as y,J as _,M,O as k,g as fe,l as S,N as P,K as ce,L as ve,S as we,aa as Q}from"../../../../../common/LoadingOutlined.BFkAxzyV.js";import{u as ye,y as ge,g as be,r as he,D as U,z as Ce,aa as _e,w as F,ab as ke,p as x,j as Se,b as Fe}from"../../../../../common/index.Ith4SzXf.js";import{t as xe}from"../../../../../common/table-elements.Bs0D33WK.js";import{C as Ae}from"../../../../../common/index.RfEH1ihW.js";import{S as X}from"../../../../../common/index.D3pgvkn5.js";import{T as Te}from"../../../../../common/index.BuOrcqbC.js";import{_ as Be}from"../../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../../common/_commonjsHelpers.BosuxZz1.js";import"../../../../../common/ExclamationCircleFilled.CrW3q_TN.js";import"../../../../../common/DownloadOutlined.D7JVmMHp.js";import"../../../../../common/ShoppingCartOutlined.B2D8qpCU.js";import"../../../../../common/Checkbox.CYa6__iO.js";import"../../../../../common/initDefaultProps.0LfrQis0.js";import"../../../../../common/FormItemContext.CuFDkfIX.js";import"../../../../../common/createContext.DiHI9yzd.js";import"../../../../../common/index.BYshCuJZ.js";import"../../../../../common/omit.DTkbSo29.js";import"../../../../../common/styleChecker.BhhSW-4N.js";import"../../../../../common/eagerComputed.Bhszqfqe.js";import"../../../../../common/vnode.BC_D2aP8.js";import"../../../../../common/collapseMotion.CnwYBKtm.js";import"../../../../../common/motion.WGHlFb5s.js";import"../../../../../common/raf.Deuc0E8-.js";import"../../../../../common/isVisible.BHYmLg1T.js";import"../../../../../common/ResizeObserver.es.B1PUzC5B.js";import"../../../../../common/_getTag.CiIQqq4n.js";import"../../../../../common/PortalWrapper.BCGj8rtm.js";import"../../../../../common/devWarning.BVoSASTV.js";import"../../../../../common/warning.CrM1WiW4.js";import"../../../../../common/BaseInput.C6Ke7hb1.js";import"../../../../../common/useState.L1hofs5h.js";import"../../../../../common/pickAttrs.GzdKbNmm.js";import"../../../../../common/index.CjASPO7n.js";import"../../../../../common/index.D28aorQO.js";import"../../../../../common/LeftOutlined.Hqnl-2Tc.js";import"../../../../../common/RightOutlined.TiLRDrc6.js";import"../../../../../common/index.BGHkQlAe.js";import"../../../../../common/KeyCode.B_gOgbN6.js";import"../../../../../common/slide.DZmo5x4X.js";import"../../../../../common/isMobile.BbN7I0i_.js";import"../../../../../common/useMergedState.DXdtLiCT.js";import"../../../../../common/DownOutlined.Bgw7W-Qg.js";import"../../../../../common/SearchOutlined.K2PZqdQC.js";import"../../../../../common/statusUtils.DES_qYlM.js";import"../../../../../common/Compact.bO-KmQeW.js";import"../../../../../common/move.iWCDh3n7.js";import"../../../../../common/compact-item.Be3L5ggo.js";import"../../../../../common/useBreakpoint.S--6DhMF.js";import"../../../../../common/responsiveObserve.BxgVt-aQ.js";import"../../../../../common/index.CUGsZk5V.js";import"../../../../../common/firstNotUndefined.CLFzEa0p.js";import"../../../../../common/index.FTpNJ4uu.js";import"../../../../../common/dropdown.CDjBCMOf.js";import"../../../../../common/index.0mGPX0wK.js";import"../../../../../common/_arrayIncludes.B8uzE354.js";import"../../../../../common/injectionKey.DGYNie3Z.js";import"../../../../../common/index.BVxneXNm.js";import"../../../../../common/colors.Do-YmLJ0.js";import"../../../../../common/index.Bdw1ik1L.js";import"../../../../../common/index.DjkvlaSA.js";import"../../../../../common/index.gaSFaOg8.js";import"../../../../../common/CaretUpOutlined.BBnMPvd9.js";import"../../../../../common/index.lxr2aJRu.js";import"../../../../../common/isPlainObject.DIpfZ0jz.js";import"../../../../../common/debounce.C88Ko_T_.js";const Ve=100,Ie=ue({__name:"FormTable",setup(De){const Y=ye(),Z=ge(),{products:i,productsSelected:d,productsSortBy:A,productsSort:g,queryingProductsView:ee,isCardFormat:V,productVariations:T}=me(Y),l=be(),I=w(null),D=w(null),b=w(!1);he();const h=p(()=>l.settings.virtualTable==="yes"),te=p(()=>l.form_body.columns.map(e=>{var o,C,m,f,c,v,q,z,H,L;const t=xe.find(u=>u.elementClass===e.elementClass);if(t.elementClass==="variation-dropdown"&&(l.settings.showVariationsIndividually!=="yes"&&(b.value=!0),i.value.data.filter(u=>u.type==="variable").length===0&&(((C=(o=e.settings)==null?void 0:o.options)==null?void 0:C.smartVisibility)==null||e.settings.options.smartVisibility==="yes")))return null;(t.elementClass==="product-name"||t.elementClass==="add-to-cart-button")&&((f=(m=e.settings)==null?void 0:m.options)==null?void 0:f.displayVariationDropdown)==="yes"&&l.settings.showVariationsIndividually!=="yes"&&(b.value=!0);const a=A.value===e.elementClass&&g.value&&"".concat(g.value,"end")||void 0;return{title:(z=(q=(v=(c=e==null?void 0:e.settings)==null?void 0:c.options)==null?void 0:v.headingText)!=null?q:t==null?void 0:t.columnName)!=null?z:t.name,dataIndex:e.elementClass,key:e.id,class:e.elementClass,sorter:((L=(H=e.settings)==null?void 0:H.options)==null?void 0:L.sortable)!=null?U().includes(e.elementClass)&&e.settings.options.sortable==="yes":U().includes(e.elementClass),sortOrder:a,customCell:()=>{var u,W,j,G,J;return{"data-label":(G=(j=(W=(u=e==null?void 0:e.settings)==null?void 0:u.options)==null?void 0:W.headingText)!=null?j:t==null?void 0:t.columnName)!=null?G:t.name,style:Ce((J=e==null?void 0:e.settings)==null?void 0:J.styles)}}}}).filter(Boolean)),ae=p(()=>{const e=l.form_body.settings.styles;let t={"--wwof-table-width":"100%","--wwof-colgroup-width":D.value};return(e==null?void 0:e.elementAlignment)!=null&&(t={...t,"--wwof-table-alignment":e.elementAlignment}),(e==null?void 0:e.tableWidth)!=null&&e.tableWidth==="auto"&&(t={...t,"--wwof-table-width":"auto"}),t}),re=e=>{const t=e.target.checked;d.value=t?i.value.data:[]},oe=p(()=>d.value.length===0||d.value.length===i.value.data.length?!1:d.value.length!==i.value.data.length),le=p(()=>d.value.length===0?!1:d.value.length===i.value.data.length),se=(e,t,a)=>{var m,f,c,v;const{order:o,field:C}=a;typeof o=="string"?(g.value=o.replace("end",""),A.value=C):(g.value=(f=(m=l==null?void 0:l.settings)==null?void 0:m.productSort)!=null?f:"asc",A.value=(v=(c=l==null?void 0:l.settings)==null?void 0:c.productSortBy)!=null?v:Fe().wcSettings.orderBy)};_e(I,e=>{const t=e[0].target.querySelector("div.ant-table-content > table"),a=t==null?void 0:t.querySelector("tr.ant-table-row-level-0");a!=null&&(V.value=getComputedStyle(a).display==="block",D.value=V.value?"100%":null)});const E=F("wwof_before_form_table",null),R=(e,t)=>F("wwof_before_bodycell_element",null,e,t),N=(e,t)=>F("wwof_after_bodycell_element",null,e,t),$=F("wwof_after_form_table",null),ie=p(()=>{var t;if(b.value===!1)return!1;const e=i.value.data.filter(a=>a.type==="variable");if(e.length===0)return!0;for(const a of e)if(((t=T==null?void 0:T.value)==null?void 0:t[a.id])==null)return!1;return!0}),ne=w(null),pe=w(null),O=p(()=>Array.isArray(i.value.data)?i.value.data:[]),{list:B}=ke(O,{itemHeight:()=>Ve,overscan:10}),de=p(()=>!B.value||B.value.length===0?O.value:B.value.map(e=>e.data));return(e,t)=>(s(),K(P,null,[r(E)?(s(),n(y({template:r(x)(r(E))}),{key:0})):_("",!0),M("div",{ref_key:"containerRef",ref:ne,class:k("wwof-".concat(h.value?"virtual-":"","table-container-ref")),style:Q("--wwof-virtual-table-height: ".concat(h.value?"".concat(r(l).settings.virtualTableHeight,"px"):"auto"))},[M("div",{ref_key:"wrapperRef",ref:pe,class:k("wwof-".concat(h.value?"virtual-":"","table-wrapper-ref"))},[fe(r(Te),{ref_key:"tableRef",ref:I,class:k("wwof-order-form ".concat(b.value===!0?"has-variation-dropdown":"")),columns:te.value,"data-source":h.value?de.value:r(i).data,"data-variations-dropdown-loaded":ie.value,"row-key":a=>a.id,style:Q(ae.value),loading:r(ee)!==r(Se).IDLE,pagination:!1,"show-sorter-tooltip":!1,onChange:se},{headerCell:S(({title:a,column:o})=>[o.dataIndex==="add-to-cart-checkbox"?(s(),n(r(Ae),{key:0,checked:le.value,indeterminate:oe.value,onChange:re},null,8,["checked","indeterminate"])):(s(),K(P,{key:1},[ce(ve(a),1)],64))]),bodyCell:S(({column:a,record:o})=>[R(a,o)?(s(),n(y({template:r(x)(R(a,o))}),{key:0})):_("",!0),(s(),n(we,null,{fallback:S(()=>[a.dataIndex==="product-image"?(s(),n(r(X),{key:0,avatar:{shape:"square",size:24},paragraph:!1,title:!1,active:""})):(s(),n(r(X),{key:1,paragraph:{rows:1},title:!1,active:""}))]),default:S(()=>[(s(),n(y(r(Z)[a.dataIndex]),{product:o,"column-id":a.key,class:k("wwof-table-field ".concat(a.dataIndex))},null,8,["product","column-id","class"]))]),_:2},1024)),N(a,o)?(s(),n(y({template:r(x)(N(a,o))}),{key:1})):_("",!0)]),_:1},8,["class","columns","data-source","data-variations-dropdown-loaded","row-key","style","loading"])],2)],6),r($)?(s(),n(y({template:r(x)(r($))}),{key:1})):_("",!0)],64))}}),Gt=Be(Ie,[["__scopeId","data-v-b0b6d54a"]]);export{Gt as default};
