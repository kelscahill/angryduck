import{d as so,G as lo,b as F,c as V,B as co,u as r,o as y,f as O,k as L,l as q,N as P,a8 as z,O as B,K,L as x,g as Q,J as N,M as uo}from"../../../../../../common/LoadingOutlined.BFkAxzyV.js";import{u as mo,k as po,_ as R,j as J,w as T,Y,c as U,v as fo}from"../../../../../../common/index.Ith4SzXf.js";import{_ as wo}from"../../../../../../common/LoadingSpinner.vue_vue_type_script_setup_true_lang.BM77UlPO.js";import{S as W}from"../../../../../../common/index.BGHkQlAe.js";import{_ as vo}from"../../../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../../../common/_commonjsHelpers.BosuxZz1.js";import"../../../../../../common/ExclamationCircleFilled.CrW3q_TN.js";import"../../../../../../common/index.CjASPO7n.js";import"../../../../../../common/initDefaultProps.0LfrQis0.js";import"../../../../../../common/motion.WGHlFb5s.js";import"../../../../../../common/raf.Deuc0E8-.js";import"../../../../../../common/vnode.BC_D2aP8.js";import"../../../../../../common/isVisible.BHYmLg1T.js";import"../../../../../../common/ResizeObserver.es.B1PUzC5B.js";import"../../../../../../common/_getTag.CiIQqq4n.js";import"../../../../../../common/PortalWrapper.BCGj8rtm.js";import"../../../../../../common/KeyCode.B_gOgbN6.js";import"../../../../../../common/BaseInput.C6Ke7hb1.js";import"../../../../../../common/pickAttrs.GzdKbNmm.js";import"../../../../../../common/slide.DZmo5x4X.js";import"../../../../../../common/isMobile.BbN7I0i_.js";import"../../../../../../common/omit.DTkbSo29.js";import"../../../../../../common/useMergedState.DXdtLiCT.js";import"../../../../../../common/useState.L1hofs5h.js";import"../../../../../../common/DownOutlined.Bgw7W-Qg.js";import"../../../../../../common/SearchOutlined.K2PZqdQC.js";import"../../../../../../common/FormItemContext.CuFDkfIX.js";import"../../../../../../common/createContext.DiHI9yzd.js";import"../../../../../../common/statusUtils.DES_qYlM.js";import"../../../../../../common/Compact.bO-KmQeW.js";import"../../../../../../common/move.iWCDh3n7.js";import"../../../../../../common/compact-item.Be3L5ggo.js";const ho=so({__name:"VariationDropdown",props:{product:{},columnId:{},variationStyle:{}},setup(t){var Z;const S=mo(),{emit:X}=po("wwofSelectedVariation".concat(t.product.id)),G=W.Option,{isCardFormat:H,productVariations:w,variationsSelected:k,standardSelected:v}=lo(S),j=F(null),g={...t.product.attributes.reduce((o,n)=>{var d;return o={...o,[n.name]:((d=n==null?void 0:n.options)==null?void 0:d[0])||(n==null?void 0:n.option)||""},o},{}),...t.product.default_attributes.reduce((o,n)=>(o={...o,[n.name]:n.option},o),{})},A=V(()=>{if(t.variationStyle)return t.variationStyle;if(t.columnId){const o=R(t.columnId,"variationStyle");if(o)return o}return"combo"}),_=V(()=>t.columnId?R(t.columnId,"hideComboVariationNamePrefix")==="yes":!1),C=(o,n=!1)=>{var d,s,e,c,p,f,a;o||(window.lodash.isEmpty(g)||(o=(e=(s=(d=w.value)==null?void 0:d[t.product.id])==null?void 0:s.data)==null?void 0:e.find(i=>{var l,u;return((u=(l=S.formPost)==null?void 0:l.settings)==null?void 0:u.showZeroInventory)!=="yes"&&i.stock_status==="outofstock"?null:window.lodash.isEqual(i.attributes.reduce((m,h)=>(m={...m,[h.name]:h.option},m),{}),g)})),window.lodash.isEmpty(o)&&(o=(f=(p=(c=w.value)==null?void 0:c[t.product.id])==null?void 0:p.data)==null?void 0:f.find(i=>i.stock_status!=="outofstock"||!0))),k.value=fo(k.value,{$merge:{[t.product.id]:(o==null?void 0:o.id)||null}}),n||(v.value={...v.value,[t.product.id]:((a=o==null?void 0:o.attributes)==null?void 0:a.length)>0&&(o==null?void 0:o.attributes.reduce((i,l)=>(i={...i,[l.name]:l.option?l.option:g[l.name]},i),{}))}),X(o)};t.product.type==="variable"&&((Z=k.value)==null?void 0:Z[t.product.id])==null&&C();const I=F(J.IDLE);co(()=>{var o;((o=t.product.variations)==null?void 0:o.length)>0&&S.getProductVariations(t.product.id,1,I).then(()=>{var n;((n=k.value)==null?void 0:n[t.product.id])==null&&C()})});const b=V(()=>{var n,d;const o=((d=(n=w.value)==null?void 0:n[t.product.id])==null?void 0:d.data)||[];return T("wwof_variation_dropdown_options",o.reduce((s,e)=>{var p,f;if(((f=(p=S.formPost)==null?void 0:p.settings)==null?void 0:f.showZeroInventory)!=="yes"&&e.stock_status==="outofstock")return s;const c=e.attributes.filter(a=>a.option==="");return window.lodash.isEmpty(c)||(e={...e,attributesWithAnyOptions:!0}),s.push(e),s},[]),t.product,t.columnId,t.variationStyle)}),oo=o=>{var d;if(((d=w==null?void 0:w.value)==null?void 0:d[t.product.id])==null||I.value!==J.IDLE)return;const n=o.target;if(n.scrollTop+n.offsetHeight===n.scrollHeight){const s=w.value[t.product.id].currentPage+1;if(s>w.value[t.product.id].totalPages)return;S.getProductVariations(t.product.id,s,I)}},eo=(o,n)=>{var s,e,c,p;v.value={...v.value,[t.product.id]:{...((s=v.value)==null?void 0:s[t.product.id])||{},[o]:n!=null?n:""}};const d=(p=(c=(e=w.value)==null?void 0:e[t.product.id])==null?void 0:c.data)==null?void 0:p.find(f=>{var u;const a=f.attributes.reduce((m,h)=>(m={...m,[h.name]:h.option},m),{}),i=JSON.parse(JSON.stringify((u=v.value)==null?void 0:u[t.product.id])),l=Object.keys(a).filter(m=>a[m]==="");return l.length>0?window.lodash.isEqual(window.lodash.omit(i,l),window.lodash.omit(a,l)):window.lodash.isEqual(i,a)});C(d,!0)},to=o=>{const n=b.value.find(d=>d.id===o);C(n)},no=o=>{var s,e,c,p,f,a,i,l,u;const n=g==null?void 0:g[o.name];let d=(c=(s=o==null?void 0:o.options)==null?void 0:s.findIndex(m=>m===n))!=null?c:(e=o==null?void 0:o.options)==null?void 0:e[0];return d===-1&&(d=0),(f=(p=v.value)==null?void 0:p[t.product.id])!=null&&f[o.name]?(i=(a=v.value)==null?void 0:a[t.product.id])==null?void 0:i[o.name]:(u=(l=o==null?void 0:o.options)==null?void 0:l[d])!=null?u:""},E=F([]),ao=o=>window.lodash.sortBy(o,"position"),$=()=>{const o=window.lodash.isEmpty(t.product.attributes)?[]:[...t.product.attributes.filter(n=>n.variation)];return ao(o)};E.value=$();const io=()=>{var e,c,p,f;const o=Object.fromEntries(Object.entries(((e=v.value)==null?void 0:e[t.product.id])||{}).filter(([a,i])=>a!==j.value&&i!=="")),n=Object.keys(o).length,s=((c=w.value)==null?void 0:c[t.product.id].data.filter(a=>{const i=window.lodash.keyBy(a.attributes,"name");let l=0;return Object.keys(o).forEach(u=>{var m,h;(((m=i[u])==null?void 0:m.option)===o[u]||((h=i[u])==null?void 0:h.option)===""||(i==null?void 0:i[u])==null)&&++l}),l===n})).reduce((a,i)=>($().forEach(l=>{var h;const u=a.findIndex(D=>D.name===l.name),m=(h=i.attributes.find(D=>D.name===l.name))==null?void 0:h.option;u===-1?a=[...a,{...l,options:[m]}]:a[u].options.includes(m)||(a[u].options=[...a[u].options,m])}),a),[]);for(const a of s)a.options.includes("")&&(a.options=[...(f=(p=$().find(i=>i.name===a.name))==null?void 0:p.options)!=null?f:[]]);E.value=s},ro=(o,n)=>{var d;if(!n){j.value=null;return}j.value=o,Object.values(Object.fromEntries(Object.entries(((d=v.value)==null?void 0:d[t.product.id])||{}).filter(([s,e])=>s&&e!==""))).filter(Boolean).length<1?E.value=$():io()},M=V(()=>b.value.some(o=>o.attributesWithAnyOptions));return(o,n)=>{var d,s;return((s=(d=r(w))==null?void 0:d[o.product.id])==null?void 0:s.total)!=null&&r(w)[o.product.id].total>0?(y(),O("div",{key:0,class:B("variation-dropdown-select-box ".concat(A.value))},[A.value==="combo"&&!M.value?(y(),L(r(W),{key:0,class:"variation-dropdown-select-control wwof-product-attribute-select-combo","dropdown-class-name":r(H)?"card-format":"",value:r(k)[o.product.id],"allow-clear":b.value.find(e=>(e==null?void 0:e.id)==="")!=null,"get-popup-container":r(Y),onPopupScroll:oo,onChange:to},{default:q(()=>[(y(!0),O(P,null,z(b.value,(e,c)=>(y(),L(r(G),{key:"".concat(o.product.id,"-").concat(e.id),value:e.id,class:B("combo-variation ".concat(r(window.lodash.kebabCase)(e.attribute_summary)))},{default:q(()=>[_.value?(y(),O(P,{key:0},[K(x(r(T)("wwof_variation_dropdown_option_label","".concat(e.attribute_summary),e,o.product,o.columnId)),1)],64)):(y(),O(P,{key:1},[K(x(r(T)("wwof_variation_dropdown_option_label","(".concat(c+1,"/").concat(b.value.length,") ").concat(e.attribute_summary),e,o.product,o.columnId)),1)],64))]),_:2},1032,["value","class"]))),128)),I.value===r(J).PENDING?(y(),L(r(G),{key:0,class:"combo-variation loading"},{default:q(()=>[Q(wo)]),_:1})):N("",!0)]),_:1},8,["dropdown-class-name","value","allow-clear","get-popup-container"])):N("",!0),A.value==="standard"||M.value?(y(!0),O(P,{key:1},z(E.value,e=>{var c,p,f;return y(),O("p",{key:"product-".concat(o.product.id,"-attribute-").concat(e.id,"-").concat((f=(p=(c=r(v))==null?void 0:c[o.product.id])==null?void 0:p[e.name])!=null?f:"none")},[uo("label",{class:B("wwof-product-attribute-label wwof-product-attribute-label-".concat(r(window.lodash.kebabCase)(e.name)))},x(e.name),3),Q(r(W),{"allow-clear":"",value:no(e),class:B("wwof-product-attribute-select wwof-product-attribute-select-standard wwof-product-attribute-select-".concat(r(window.lodash.kebabCase)(e.name))),"dropdown-class-name":r(H)?"card-format":"","get-popup-container":r(Y),placeholder:r(wp.i18n.sprintf)(r(U)("selectAttribute",r(wp.i18n.__)("Select %s","woocommerce-wholesale-order-form")),e.name),options:[{value:"",label:r(U)("chooseAnOption",r(wp.i18n.__)("Choose an option","woocommerce-wholesale-order-form")),class:"wwof-tw-text-gray-400 standard-variation"},...e.options.map(a=>({value:a,label:a,class:"standard-variation ".concat(r(window.lodash.kebabCase)(a))}))],onChange:a=>eo(e.name,a),onDropdownVisibleChange:a=>ro(e.name,a)},null,8,["value","class","dropdown-class-name","get-popup-container","placeholder","options","onChange","onDropdownVisibleChange"])])}),128)):N("",!0)],2)):N("",!0)}}}),Yo=vo(ho,[["__scopeId","data-v-6893f35b"]]);export{Yo as default};
