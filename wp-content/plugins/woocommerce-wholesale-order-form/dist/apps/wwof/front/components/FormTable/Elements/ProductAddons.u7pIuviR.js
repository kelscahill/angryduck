import{d as S,i as q,G as N,b as z,c as v,B as H,u as p,o as J,f as L,M as y,O as F,J as G}from"../../../../../../common/LoadingOutlined.BFkAxzyV.js";import{u as R,k as T,_ as W,v as h}from"../../../../../../common/index.Ith4SzXf.js";import{_ as K}from"../../../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../../../common/_commonjsHelpers.BosuxZz1.js";import"../../../../../../common/ExclamationCircleFilled.CrW3q_TN.js";const U=["data-product_id","data-product_variations"],X=["innerHTML"],Y={class:"quantity"},Z=["value"],_=S({__name:"ProductAddons",props:{product:{},columnId:{},modelValue:{type:Boolean,default:!1}},setup(t){var C;const V=q("$window"),Q=R(),{variationsSelected:b,quantities:j,productAddonsForm:e,addToCartFormData:w}=N(Q),{on:E}=T("wwofSelectedVariation".concat(t.product.id)),{on:P}=T("wwofCurrentProductQuantity".concat(t.product.id)),c=z({}),$=(C=t.product.wwof_product_addons)!=null?C:[],x=v(()=>W(t.columnId,"displayProductAddonTotals")!=="yes");H(()=>{!t.product.wwof_product_addons&&window.lodash.isEmpty(t.product.wwof_product_addons)||(B(),k())});const B=()=>{window.jQuery(function(){const o=t.modelValue?window.jQuery("body").find(".ant-modal form.cart.wwof-addons-container:not(.cart_group)"):window.jQuery("body").find("#product-name-"+t.product.id+".wwof-table-field.product-name form.cart.wwof-addons-container:not(.cart_group)"),a=V.WC_PAO.Form(o),d=new FormData;t.modelValue!==!0?e.value=h(e.value,{$merge:{[t.product.id]:a||null}}):c.value=a,w.value=h(w.value,{$merge:{[t.product.id]:d}}),t.product.type==="variable"&&g()})},k=()=>{window.jQuery(function(){var a;let o={};t.modelValue!==!0?o=(a=e.value)==null?void 0:a[t.product.id].$el:o=c.value.$el,o.on("blur change",".wc-pao-addon input, .wc-pao-addon textarea, .wc-pao-addon select, .wc-pao-addon-custom-text",function(){var u,f;const d=(f=(u=w.value)==null?void 0:u[t.product.id])!=null?f:new FormData;o.find("input, textarea, select").each((l,m)=>{const n=window.jQuery(m);if(n===void 0)return;let r=n.attr("name"),i=n.val(),s=n.attr("type"),O=n.closest(".wc-pao-addon");if(d.delete(r),!(r===void 0||i===void 0||i===""))if(s==="file"){if(i=n.get(0).files[0],i===void 0)return;d.append(r,i)}else s==="checkbox"||s==="radio"?O.find("input").each((tt,I)=>{const A=window.jQuery(I);A.is(":checked")===!0&&d.append(r,A.val())}):d.append(r,i)}),w.value=h(w.value,{$merge:{[t.product.id]:d}})})})},g=()=>{var u,f;if(!t.product.wwof_product_addons&&window.lodash.isEmpty(t.product.wwof_product_addons))return;const o=(u=b.value)==null?void 0:u[t.product.id],a=((f=e.value)==null?void 0:f[t.product.id].$el.data("product_variations"))||[];if(window.lodash.isEmpty(a)||!o)return;const d=a.findIndex(l=>(l==null?void 0:l.variation_id)===o);d!==null&&window.jQuery(function(){var l,m,n,r,i,s;t.modelValue!==!0?((l=e.value)==null||l[t.product.id].totals.updateVariation(a[d]),(m=e.value)==null||m[t.product.id].validation.validate(),(n=e.value)==null||n[t.product.id].updateTotals()):((r=c.value)==null||r.totals.updateVariation(a[d]),(i=c.value)==null||i.validation.validate(),(s=c.value)==null||s.updateTotals())})},D=v(()=>t.product.type==="variable"?JSON.stringify(t.product.wwof_product_addons.variations_data):null),M=v(()=>{const o=t.modelValue?"wwof-addons-on-modal":"";return t.product.type==="variable"?"variations_form cart wwof-addons-container ".concat(o):"cart wwof-addons-container ".concat(o)});return E(o=>{!o&&window.lodash.isEmpty(t.product.wwof_product_addons)||g()}),P(()=>{!t.product.wwof_product_addons&&window.lodash.isEmpty(t.product.wwof_product_addons)||window.jQuery(function(){var o,a,d,u;t.modelValue!==!0?((o=e.value)==null||o[t.product.id].validation.validate(),(a=e.value)==null||a[t.product.id].updateTotals()):((d=c.value)==null||d.validation.validate(),(u=c.value)==null||u.updateTotals())})}),(o,a)=>{var d;return p($).length!==0?(J(),L("form",{key:0,class:F(M.value),"data-product_id":"".concat(o.product.id),"data-product_variations":"".concat(D.value),method:"post",enctype:"multipart/form-data"},[y("div",{class:F(x.value?"wwof-addons hide-product-addons-totals":"wwof-addons"),innerHTML:p($).html},null,10,X),y("div",Y,[y("input",{class:"qty",type:"hidden",value:(d=p(j))==null?void 0:d[o.product.id]},null,8,Z)])],10,U)):G("",!0)}}}),it=K(_,[["__scopeId","data-v-d6117877"]]);export{it as default};
