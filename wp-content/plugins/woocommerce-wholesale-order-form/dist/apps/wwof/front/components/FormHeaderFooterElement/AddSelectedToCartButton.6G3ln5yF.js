import{d as ae,G as re,c as T,b as V,o as I,f as k,g as y,l as v,u as s,aa as q,N as D,K as j,L as H,k as se,S as ie,J as de,h as O}from"../../../../../common/LoadingOutlined.BFkAxzyV.js";import{u as ne,T as le,V as ce,w as me,p as ue,c as _,j as fe,W as pe,d as R,X as G,B as L,Y as M,Z as ye}from"../../../../../common/index.Ith4SzXf.js";import{_ as we}from"../../../../../common/LoadingSpinner.vue_vue_type_script_setup_true_lang.BM77UlPO.js";import{B as ve}from"../../../../../common/index.Bdw1ik1L.js";import{a as he}from"../../../../../common/index.D3pgvkn5.js";import{C as W,R as Ce}from"../../../../../common/index.D3Qmjxc3.js";import"../../../../../common/_commonjsHelpers.BosuxZz1.js";import"../../../../../common/ExclamationCircleFilled.CrW3q_TN.js";import"../../../../../common/index.CjASPO7n.js";import"../../../../../common/initDefaultProps.0LfrQis0.js";import"../../../../../common/index.DjkvlaSA.js";import"../../../../../common/isVisible.BHYmLg1T.js";import"../../../../../common/useState.L1hofs5h.js";import"../../../../../common/raf.Deuc0E8-.js";import"../../../../../common/devWarning.BVoSASTV.js";import"../../../../../common/warning.CrM1WiW4.js";import"../../../../../common/compact-item.Be3L5ggo.js";import"../../../../../common/createContext.DiHI9yzd.js";import"../../../../../common/Compact.bO-KmQeW.js";import"../../../../../common/_getTag.CiIQqq4n.js";import"../../../../../common/omit.DTkbSo29.js";import"../../../../../common/Col.C48UZKBg.js";import"../../../../../common/responsiveObserve.BxgVt-aQ.js";import"../../../../../common/useFlexGapSupport.BqBlA3Mn.js";import"../../../../../common/styleChecker.BhhSW-4N.js";const $e=ae({__name:"AddSelectedToCartButton",props:{sectionName:{},rowId:{},columnId:{},fieldId:{}},setup(l){const $=R("components/FormTable/Extras/AddToCartSuccess.vue"),z=R("components/FormTable/Extras/SimplifyViewCart.vue"),h=ne(),{addItemToCartRequest:J,productsSelected:b,standardSelected:A,quantities:K,addToCartFormData:X}=re(h),i=le(l.sectionName,l.rowId,l.columnId,l.fieldId),Y=T(()=>ce(l.sectionName,l.rowId,l.columnId,l.fieldId)),Z=T(()=>{var t;return me("wwof_add_selected_to_cart_button_text",ue(((t=i==null?void 0:i.options)==null?void 0:t.buttonText)||_("addSelectedProductsToCart",wp.i18n.__("Add Selected Products To Cart","woocommerce-wholesale-order-form"))))}),g=V(!1),E=T(()=>J.value===fe.PENDING),S=V(null),Q=async()=>{var N,P;S.value=null;const t=(P=(N=i==null?void 0:i.options)==null?void 0:N.notificationDuration)!=null?P:10;g.value=!0;let o=[],d=b.value.map(e=>{var n,f;let a={id:e.id,quantity:(f=(n=K.value)==null?void 0:n[e.id])!=null?f:1};if(e.type==="variable"){const c=G(e).value;c.attributes.some(r=>r.option==="")?a={...a,variation:Object.keys(A.value[e.id]).map(r=>({attribute:r,value:A.value[e.id][r]}))}:a={...a,id:c.id,parent_id:e.id}}return o.push({...G(e).value,quantity:a.quantity}),a}),u=d.filter((e,a,n)=>{var c,w,r;const f=(w=(c=e==null?void 0:e.parent_id)!=null?c:e==null?void 0:e.id)!=null?w:null;return((r=X.value)==null?void 0:r[f])!==void 0});u.length>0&&(d=d.filter(e=>!u.includes(e))),await Promise.all([U(d),ee(u)]).then(e=>{var f,c,w,r,F,x,B;g.value=!1;let a=[],n=[];if(e[0]!=null&&((f=e[0])!=null&&f.items&&(a=e[0].items),(c=e[0])!=null&&c.errors))for(const p of e[0].errors)n.push("<p>".concat(p.body.message,"</p>"));if(e[1]!==void 0)for(const[p,m]of Object.entries(e[1]))if(m.response.status===201)for(const C of m.response.data.items)a.push(C);else((r=(w=m.response)==null?void 0:w.error)==null?void 0:r.message)!=null&&(n.push(m.response.error.message),o=o.filter(C=>C.id!==parseInt(p)));a&&a.length>0&&(a=a.filter((p,m,C)=>m===C.findIndex(oe=>oe.key===p.key)),((x=(F=h.formPost)==null?void 0:F.settings)==null?void 0:x.simplifyAddToCartNotices)==="no"&&((B=i==null?void 0:i.options)==null?void 0:B.showAddToCartNotification)!=="no"?L.success({message:_("successfullyAdded",wp.i18n.__("Successfully added:","woocommerce-wholesale-order-form")),description:O($,{products:o,itemsOnCart:a}),duration:t,getContainer:M}):S.value=a.reduce((p,m)=>p+m.quantity,0),b.value=[],document.body.dispatchEvent(new Event("wc_fragment_refresh"))),n&&n.length>0&&L.error({message:_("errorAddingToCart",wp.i18n.__("Error adding to cart:","woocommerce-wholesale-order-form")),description:O("div",{innerHTML:wp.htmlEntities.decodeEntities(n.join(""))}),duration:t,getContainer:M}),ye("wwof_add_selected_to_cart_request_response",e,d)})},U=async t=>{if(t.length>0)try{return await h.addItemsToCart(t)}catch(o){return o}},ee=async t=>{if(t.length>0){let o=[];for(const d of t)try{const u=await h.addItemToCart(d);o={...o,[d.id]:{response:u}}}catch(u){o={...o,[d.id]:{error:u}}}return o}},te=T(()=>{var t,o;return S.value&&((o=(t=h.formPost)==null?void 0:t.settings)==null?void 0:o.simplifyAddToCartNotices)!=="no"});return(t,o)=>(I(),k("div",{class:"add-selected-to-cart-button-box",style:q(s(pe)(t.sectionName,t.rowId,t.columnId,t.fieldId))},[y(s(Ce),null,{default:v(()=>[y(s(W),{xs:"24",sm:"8"},{default:v(()=>[y(s(ve),{type:"primary",style:q(Y.value),disabled:s(b).length===0||g.value||E.value,onClick:Q},{default:v(()=>[g.value||E.value?(I(),k(D,{key:0},[j(H(s(_)("addingProducts",s(wp.i18n.__)("Adding products to cart...","woocommerce-wholesale-order-form")))+"Â  ",1),y(we)],64)):(I(),k(D,{key:1},[j(H(Z.value),1)],64))]),_:1},8,["style","disabled"])]),_:1}),y(s(W),{xs:"24",sm:"16"},{default:v(()=>[te.value?(I(),se(ie,{key:0},{fallback:v(()=>[y(s(he),{active:""})]),default:v(()=>[y(s(z),{"products-added":S.value},null,8,["products-added"])]),_:1})):de("",!0)]),_:1})]),_:1})],4))}});export{$e as default};
